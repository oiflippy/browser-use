(()=>{"use strict";let e=null,t={url:window.location.href,title:document.title,domSnapshot:"",lastUpdate:Date.now()};function s(){const e=document.querySelectorAll("a, button, input, select, textarea"),t=Array.from(e).map((e=>{const t=e.getBoundingClientRect();return{tagName:e.tagName,id:e.id,className:e.className,text:e.textContent?.trim().substring(0,50),visible:t.width>0&&t.height>0,position:{x:t.left,y:t.top,width:t.width,height:t.height}}}));return JSON.stringify(t)}function n(){e&&e.disconnect(),e=new MutationObserver((e=>{Date.now()-t.lastUpdate>1e3&&o()})),e.observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0,characterData:!0})}function o(){t={url:window.location.href,title:document.title,domSnapshot:s(),lastUpdate:Date.now()},chrome.runtime.sendMessage({type:"DOM_UPDATE",pageState:t}).catch((e=>{console.log("发送DOM更新失败:",e)}))}function c(e){try{return document.querySelector(e)}catch(e){return console.error("选择器语法错误:",e),null}}function a(){console.log("Browser Use 内容脚本已加载"),n(),o()}chrome.runtime.onMessage.addListener(((e,s,a)=>("PAGE_LOADED"===e.type?(n(),o(),a({success:!0})):"PERFORM_ACTION"===e.type?a(function(e){switch(console.log("执行操作:",e),e.type){case"CLICK":const t=c(e.selector);return t?(t.click(),{success:!0,message:"点击成功"}):{success:!1,message:"未找到元素"};case"INPUT":const s=c(e.selector);if(s&&"INPUT"===s.tagName){s.value=e.text;const t=new Event("input",{bubbles:!0});return s.dispatchEvent(t),{success:!0,message:"输入成功"}}return{success:!1,message:"未找到输入元素"};case"SCROLL":return window.scrollTo({top:e.y,left:e.x,behavior:"smooth"}),{success:!0,message:"滚动成功"};default:return{success:!1,message:"未知操作类型"}}}(e.action)):"GET_PAGE_STATE"===e.type&&(o(),a({success:!0,pageState:t})),!0))),"complete"===document.readyState?a():window.addEventListener("load",a)})();